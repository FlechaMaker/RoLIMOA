# RoLIMOA: **Ro**bocon **L**ivestreaming **I**ntegrated **M**atch **O**perating **A**pp

NHK学生ロボコンのようなロボットコンテストの大会で、青・赤チームの得点を各担当が入力し、それを会場のスクリーンやライブストリーミング（動画配信）に表示する統合的なシステムです。

## 使い方

### 設定ファイルの編集

client/src/config.jsonを編集して、好みの設定にします。特にルールに関する`rule.task_objects`, `rule.score`, `rule.vgoal`を編集します。server/src/config.jsonも同じ内容で保存してください。

### 本番環境の起動方法

サーバ側でクライアントのビルド済みファイルをホスティングしているので、実際の大会時には次のような運用を想定しています。

```bash
cd path/to/project

# クライアントをビルド
cd ./client
yarn build

# サーバを起動する
cd ../server
npm start
```

http://localhost:8000 で管理画面を開けるようになります。OS側でTCP/8000のポートを開放すれば、他のデバイスからも操作できます。

### 仕様 / Tips

現在、次の使い方・環境を想定しています。

- 「青/赤チーム入力」ページは、それぞれの担当者が各デバイスで使用
    - UIの最適化はしていないが、スマホでも操作できる
- 「スクリーン」ページは、1920x1080の画面にFirefoxで全画面化で表示
    - このページではconfig.jsonで設定された効果音が再生される
    - タイマの挙動が不安定になったときは、ページのF5でリロードで直る
- 「配信オーバーレイ」ページは、OBSのBrowser Sourceで使用
    - Browser SourceはOBS上で1600x900の大きさ
    - Browser Sourceでは音声を再生せず、配信には会場の音を取り込む

## 開発方法

### 始める

開発時には、サーバとクライアントをそれぞれ起動して開発します。

#### サーバ側

次のコマンドでサーバを起動します。サーバ側のコードを変更したときは、手動で再起動します。

```bash
npm start
```

#### クライアント側

次のコマンドを実行してから http://localhost:3000 にアクセスします。コードを編集して保存すると、自動で再ビルドが走ります。クライアントの方はnpmでなくyarnであるに注意してください。

```bash
yarn start
```

### 要素技術

このプロジェクトでは次の言語やライブラリを用いているので、開発にはそれぞれの基礎知識が必要です。

- TypeScript
- React
- Redux (Redux Toolkit)
- Recoil
- WebSocket (socket.io)
- Express

### TODO: 今後追加したい機能や、改善したい点など

#### タイマー、時刻表示の改善

タイマーが二重に起動して表示が安定しないことや、意図しない音声再生するときがあるので改善したい。

#### config.jsonの改善

config.jsonを読み書きしやすいyamlに変更したり、TypeScriptの型を使っていい感じにバリデーションしたり、サーバとクライアントでの二重管理の解消したりしたい。

#### 各試合のログ保存・再生

各試合でチームの点数状況などを保存したり、得点の増減など各操作を記録して再現したりする機能が欲しい。

#### サーバとクライアントのコードの共通化

サーバとクライアントの両方でRedux（Redux Toolkit）を用いているので`server/src/features/*.ts`と`client/src/features/*.ts`で同じコードを管理している。1つにまとめたい。
